#N canvas 63 63 1198 780 12;
#X declare -path abs;
#X msg 17 56 listen 4567;
#X msg 142 55 listen 0;
#X obj 17 25 loadbang;
#X obj 134 555 outlet~;
#X obj 213 555 outlet~;
#X obj 288 555 outlet~;
#X obj 365 555 outlet~;
#X obj 443 555 outlet~;
#X obj 521 555 outlet~;
#X obj 599 555 outlet~;
#X obj 677 555 outlet~;
#X obj 640 187 s analogBlockSize;
#N canvas 597 418 609 655 counter 0;
#X obj 79 9 inlet;
#X obj 110 68 outlet;
#X obj 75 163 f;
#X msg 31 213 0;
#X obj 88 258 sel 1;
#X obj 87 195 + 1;
#X obj 79 40 t b l;
#X obj 150 297 s rewrite;
#X obj 61 382 f;
#X obj 73 501 sel 1;
#X obj 73 414 + 1;
#X obj 75 574 s resync;
#X msg 18 436 0;
#X obj 247 495 spigot;
#X msg 293 466 0;
#X obj 327 467 tgl 19 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X obj 104 417 r reSyncClockInSeconds, f 11;
#X obj 327 377 r trigResync;
#X obj 88 234 >=;
#X obj 73 477 >=;
#X obj 157 99 r bufferSizeInSamples;
#X obj 199 125 r analogBlockSize;
#X obj 157 183 /;
#X text 120 471 reSync read and writeheads every x seconds, f 15;
#X text 125 237 num of blocks before wrapping circular buffer;
#X obj 171 273 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X text 177 38 and to keep the phasor (read head) in sync;
#X floatatom 157 207 5 0 0 0 - - - 0;
#X obj 199 150 t b b f;
#X msg 215 203 1;
#X obj 153 125 t b f;
#X text 225 297 wrap the writeheads;
#X text 142 3 counter: tells the sample writers to wrap to the start of circular buffer, f 36;
#X text 142 574 keep the phasor (read head) in sync;
#X text 249 203 reset writehead to start position;
#X obj 327 401 del 500;
#X connect 0 0 6 0;
#X connect 2 0 5 0;
#X connect 3 0 2 1;
#X connect 4 0 3 0;
#X connect 4 0 7 0;
#X connect 4 0 8 0;
#X connect 4 0 13 0;
#X connect 4 0 25 0;
#X connect 5 0 2 1;
#X connect 5 0 18 0;
#X connect 6 0 2 0;
#X connect 6 1 1 0;
#X connect 8 0 10 0;
#X connect 9 0 11 0;
#X connect 9 0 12 0;
#X connect 10 0 8 1;
#X connect 10 0 19 0;
#X connect 12 0 8 1;
#X connect 13 0 11 0;
#X connect 13 0 14 0;
#X connect 14 0 15 0;
#X connect 15 0 13 1;
#X connect 16 0 19 1;
#X connect 17 0 35 0;
#X connect 18 0 4 0;
#X connect 19 0 9 0;
#X connect 20 0 30 0;
#X connect 21 0 28 0;
#X connect 22 0 27 0;
#X connect 22 0 18 1;
#X connect 28 0 29 0;
#X connect 28 1 22 0;
#X connect 28 2 22 1;
#X connect 29 0 4 0;
#X connect 30 0 29 0;
#X connect 30 1 22 0;
#X connect 35 0 15 0;
#X restore 104 225 pd counter;
#X obj 528 255 s bufferSizeInSamples;
#X obj 527 300 s delay;
#X msg 574 210 60;
#X obj 574 232 s reSyncClockInSeconds;
#X obj 495 278 t b f;
#X obj 495 322 s trigResync;
#X msg 495 255 5;
#X obj 458 20 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X text 774 186 incoming block size from Bela;
#X text 686 255 PD buffer size;
#X text 108 56 on;
#X text 209 54 off;
#X text 741 231 how often to resync buffer read and buffer writeheads;
#X obj 104 248 bufWrite8 0;
#X obj 104 272 bufWrite8 1;
#X obj 104 296 bufWrite8 2;
#X obj 104 320 bufWrite8 3;
#X obj 607 210 s analogChannels;
#X text 677 163 << set to analog \, not audio blocks size!;
#X msg 529 233 22048;
#X msg 607 187 8;
#N canvas 707 533 450 300 init 0;
#X obj 32 21 r initValues;
#X obj 32 45 t b l;
#X obj 65 83 unpack f f f;
#X msg 5 137 set \$1;
#X msg 76 138 set \$1;
#X msg 134 141 set \$1;
#X obj 5 162 outlet;
#X obj 76 162 outlet;
#X obj 134 165 outlet;
#X obj 260 164 outlet;
#X obj 260 108 del 950;
#X obj 324 108 s blink;
#X obj 259 39 inlet;
#X connect 0 0 1 0;
#X connect 1 0 10 0;
#X connect 1 0 11 0;
#X connect 1 1 2 0;
#X connect 2 0 3 0;
#X connect 2 1 5 0;
#X connect 2 2 4 0;
#X connect 3 0 6 0;
#X connect 4 0 7 0;
#X connect 5 0 8 0;
#X connect 10 0 9 0;
#X connect 12 0 10 0;
#X connect 12 0 11 0;
#X restore 457 45 pd init;
#N canvas 635 461 631 561 starter 0;
#X obj 244 90 inlet;
#X obj 297 126 b;
#X obj 244 354 outlet;
#X obj 245 304 spigot;
#X msg 163 243 1;
#X msg 200 244 0;
#N canvas 126 508 626 538 initValues 0;
#X obj 107 4 inlet;
#X obj 133 282 pack f f f;
#X msg 78 202 22048;
#X msg 131 202 44096;
#X obj 180 466 s initValues;
#X msg 184 202 88192;
#X obj 78 170 sel 22050 44100 88200;
#X obj 291 180 print block size;
#X obj 291 153 print channels;
#X floatatom 122 236 5 0 0 0 - - - 0;
#X text 205 -23 samplerate \, frames \, channels;
#X obj 175 87 unpack f f f;
#X obj 86 465 outlet;
#X obj 291 207 print bela sample rate;
#X obj 130 339 t b l;
#X connect 0 0 11 0;
#X connect 1 0 14 0;
#X connect 2 0 9 0;
#X connect 3 0 9 0;
#X connect 5 0 9 0;
#X connect 6 0 2 0;
#X connect 6 1 3 0;
#X connect 6 2 5 0;
#X connect 9 0 1 0;
#X connect 11 0 6 0;
#X connect 11 0 13 0;
#X connect 11 1 7 0;
#X connect 11 1 1 1;
#X connect 11 2 8 0;
#X connect 11 2 1 2;
#X connect 14 0 12 0;
#X connect 14 1 4 0;
#X restore 119 157 pd initValues;
#X obj 324 189 s off;
#X obj 297 153 delay 100;
#X text 43 188 re-open once state updated, f 13;
#X text 32 292 spigot for analog data, f 12;
#X text 367 190 clear buffers if analog data stops;
#N canvas 821 366 1023 568 handshake 0;
#X obj 188 27 b;
#X msg 395 94 connect 192.168.7.2 7562;
#X obj 188 150 netsend -u -b;
#X obj 188 82 oscformat osc-setup-reply;
#X obj 546 29 loadbang;
#X obj 546 53 metro 1000;
#X obj 188 193 print bela connected;
#X msg 573 -1 stop;
#X msg 610 28 1;
#X obj 404 184 sel 1 0;
#X obj 188 -9 inlet;
#X obj 427 222 s off;
#X text 645 20 try to reconnect to Bela if disconnected, f 14;
#X text 69 83 Bela handshake;
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 2 0 6 0;
#X connect 2 0 9 0;
#X connect 3 0 2 0;
#X connect 4 0 5 0;
#X connect 5 0 1 0;
#X connect 7 0 5 0;
#X connect 8 0 5 0;
#X connect 9 0 7 0;
#X connect 9 1 8 0;
#X connect 9 1 11 0;
#X connect 10 0 0 0;
#X restore 24 155 pd handshake;
#X obj 24 25 netreceive -u -b 5000;
#X obj 24 63 oscparse;
#X obj 24 90 list trim;
#X obj 24 117 route osc-setup osc-settings;
#X obj 201 221 r off;
#X text 307 34 starter: sync PD and Bela settings when Bela starts up and state data is received, f 30;
#X obj 163 198 del 1250;
#X connect 0 0 1 0;
#X connect 0 0 3 0;
#X connect 1 0 8 0;
#X connect 3 0 2 0;
#X connect 4 0 3 1;
#X connect 5 0 3 1;
#X connect 6 0 19 0;
#X connect 8 0 7 0;
#X connect 13 0 14 0;
#X connect 14 0 15 0;
#X connect 15 0 16 0;
#X connect 16 0 12 0;
#X connect 16 1 6 0;
#X connect 17 0 5 0;
#X connect 19 0 4 0;
#X restore 106 187 pd starter;
#X obj 104 343 bufWrite8 4;
#X obj 104 367 bufWrite8 5;
#X obj 104 391 bufWrite8 6;
#X obj 104 415 bufWrite8 7;
#X text 377 629 supports up to 64 sample analog block size;
#X obj 556 100 t b b b b b;
#X text 377 670 Sample Rate 'conversion': Bela: 22050 = PD: 22048 Bela: 44100 = PD: 44096;
#X text 487 18 click to reset PD state;
#X text 587 298 writehead delay in ms \, increase if jitter in Bela analog stream, f 64;
#X text 588 322 resync buffer read and writeheads;
#X obj 105 119 netreceive -u -b;
#X obj 968 438 declare -path abs;
#X obj 134 531 bufRead 0;
#X obj 213 531 bufRead 1;
#X obj 288 531 bufRead 2;
#X obj 365 531 bufRead 3;
#X obj 443 531 bufRead 4;
#X obj 521 531 bufRead 5;
#X obj 599 531 bufRead 6;
#X obj 677 531 bufRead 7;
#X text 969 742 Brian Lindgren (c) 2024;
#X msg 640 163 8;
#X connect 0 0 46 0;
#X connect 1 0 46 0;
#X connect 2 0 0 0;
#X connect 12 0 26 0;
#X connect 15 0 16 0;
#X connect 17 0 18 0;
#X connect 17 1 14 0;
#X connect 19 0 17 0;
#X connect 20 0 34 0;
#X connect 26 0 27 0;
#X connect 27 0 28 0;
#X connect 28 0 29 0;
#X connect 29 0 36 0;
#X connect 32 0 13 0;
#X connect 33 0 30 0;
#X connect 34 0 32 0;
#X connect 34 1 33 0;
#X connect 34 2 57 0;
#X connect 34 3 41 0;
#X connect 35 0 12 0;
#X connect 36 0 37 0;
#X connect 37 0 38 0;
#X connect 38 0 39 0;
#X connect 41 0 19 0;
#X connect 41 1 15 0;
#X connect 41 2 32 0;
#X connect 41 3 57 0;
#X connect 41 4 33 0;
#X connect 46 0 35 0;
#X connect 48 0 3 0;
#X connect 49 0 4 0;
#X connect 50 0 5 0;
#X connect 51 0 6 0;
#X connect 52 0 7 0;
#X connect 53 0 8 0;
#X connect 54 0 9 0;
#X connect 55 0 10 0;
#X connect 57 0 11 0;
